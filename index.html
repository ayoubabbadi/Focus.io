<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 1. NEW: Clean Font Palette */
            --font-digital: 'Orbitron', sans-serif;
            --font-ui: 'Manrope', sans-serif;

            /* 2. NEW: Clean Color Palette (Light Theme) */
            --color-bg: #f9fafb; /* bg-gray-50 */
            --color-text: #1f2937; /* text-gray-800 */
            --color-text-dim: #6b7280; /* text-gray-500 */
            --color-border: #e5e7eb; /* border-gray-200 */
            
            /* 3. NEW: Creative Gradient Accents (Default) */
            --color-accent-start: #c4b5fd; /* violet-300 */
            --color-accent-end: #f0abfc; /* fuchsia-300 */
        }

        /* 4. NEW: State-based Theming */
        body.state-focus {
            --color-bg: #fef2f2; /* bg-red-50 */
            --color-accent-start: #fda4af; /* rose-300 */
            --color-accent-end: #fb923c; /* orange-400 */
        }
        body.state-break {
            --color-bg: #eff6ff; /* bg-blue-50 */
            --color-accent-start: #93c5fd; /* blue-300 */
            --color-accent-end: #5eead4; /* teal-300 */
        }

        /* 5. NEW: Base Styles */
        body {
            font-family: var(--font-ui);
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.5s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none;
        }

        /* 6. NEW: Timer & Digital Font Styling */
        .digital-font {
            font-family: var(--font-digital);
        }
        .timer-text {
            /* Apply gradient to text */
            background-image: linear-gradient(to right, var(--color-accent-start), var(--color-accent-end));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            transition: all 0.5s ease;
        }
        .session-text {
            color: var(--color-text-dim);
            transition: all 0.5s ease;
        }
        .app-title {
             background-image: linear-gradient(to right, var(--color-accent-start), var(--color-accent-end));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            transition: all 0.5s ease;
        }

        /* 7. NEW: Soft Button Styles */
        .btn {
            @apply rounded-lg font-semibold transition-all;
        }
        .btn-primary {
            background-image: linear-gradient(to right, var(--color-accent-start), var(--color-accent-end));
            color: white;
            box-shadow: 0 4px 20px -5px var(--color-accent-start);
        }
        .btn-primary:hover {
            filter: brightness(1.1);
            box-shadow: 0 6px 25px -5px var(--color-accent-start);
        }
        .btn-secondary {
            background-color: #ffffff;
            color: var(--color-text-dim);
            border: 1px solid var(--color-border);
            box-shadow: 0 4px 10px -5px #0000001a;
        }
        .btn-secondary:hover {
            background-color: #f9fafb; /* bg-gray-50 */
            color: var(--color-text);
        }
        .btn-icon {
            color: var(--color-text-dim);
            @apply p-3 text-lg;
        }
        .btn-icon:hover {
            color: var(--color-text);
        }
        
        /* 8. NEW: Mode Button Styles (Pill Shape) */
        .mode-btn {
            background-color: transparent;
            color: var(--color-text-dim);
            @apply py-2 px-6 rounded-full uppercase tracking-wider text-sm font-bold;
        }
        .mode-btn:hover {
            color: var(--color-text);
        }
        .mode-btn-active {
            background-image: linear-gradient(to right, var(--color-accent-start), var(--color-accent-end));
            color: white !important;
            box-shadow: 0 4px 20px -5px var(--color-accent-start);
        }
        
        /* 9. NEW: Modal Styles */
        .modal-overlay { @apply fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center; }
        .modal-content {
            background-color: #ffffff; /* White background */
            @apply p-8 rounded-lg shadow-xl text-left;
        }
        .modal-content label { @apply block text-gray-500 text-sm font-bold mb-2; }
        .modal-content input {
            background-color: #f3f4f6; /* bg-gray-100 */
            @apply text-gray-800 p-2 rounded w-full mb-4 border border-gray-300;
        }

    </style>
</head>

<body class="overflow-hidden">

    <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/impacts/ringing_vessel_solid.ogg" preload="auto"></audio>
    
    <header class="flex justify-between items-center p-4 w-full absolute top-0 left-0">
        <h1 class="text-xl font-bold digital-font app-title">
            <i class="fa-solid fa-bolt-lightning"></i>
            focus.io
        </h1>
        <button id="settings-btn" class="btn-icon text-xl" title="Settings">
            <i class="fas fa-cog"></i>
        </button>
    </header>

    <div class="flex flex-col items-center justify-center h-screen w-full p-4 pt-20">

        <div class="flex-1 flex flex-col items-center justify-center text-center p-8">
            <div class="flex space-x-2 md:space-x-4 justify-center mb-12 bg-gray-200 p-2 rounded-full">
                <button id="focus-btn" class="mode-btn digital-font mode-btn-active">Focus</button>
                <button id="short-btn" class="mode-btn digital-font">Short Break</button>
                <button id="long-btn" class="mode-btn digital-font">Long Break</button>
            </div>

            <div id="timer-display" class="timer-text digital-font text-8xl md:text-9xl font-bold tracking-widest mb-12">
                25:00
            </div>

            <div class="flex space-x-4 justify-center mb-12">
                <button id="start-pause-btn" class="btn btn-primary text-4xl w-24 h-24 rounded-full flex items-center justify-center" title="Start (Space)">
                    <i class="fas fa-play"></i>
                </button>
                <button id="skip-btn" class="btn btn-secondary text-2xl w-24 h-24 rounded-full flex items-center justify-center" title="Skip Session">
                    <i class="fas fa-forward-step"></i>
                </button>
            </div>

            <div id="session-count" class="session-text digital-font text-xl tracking-wider">
                Session: 1 of 4
            </div>
        </div>
    </div>


    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content w-96">
            <h2 class="text-2xl font-bold mb-6">Settings</h2>
            <div class="grid grid-cols-2 gap-4">
                <div><label for="focus-time">Focus (min)</label><input type="number" id="focus-time" min="1"></div>
                 <div><label for="short-time">Short Break (min)</label><input type="number" id="short-time" min="1"></div>
                <div><label for="long-time">Long Break (min)</label><input type="number" id="long-time" min="1"></div>
                <div><label for="sessions">Sessions</label><input type="number" id="sessions" min="1"></div>
            </div>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="close-settings-btn" class="btn btn-secondary py-2 px-6">Cancel</button>
                <button id="save-settings-btn" class="btn btn-primary py-2 px-6">Save</button>
            </div>
        </div>
    </div>

    <script>
        // --- Timer DOM Elements ---
        const timerDisplay = document.getElementById('timer-display');
        const focusBtn = document.getElementById('focus-btn');
        const shortBtn = document.getElementById('short-btn');
        const longBtn = document.getElementById('long-btn');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const skipBtn = document.getElementById('skip-btn');
        const sessionCountDisplay = document.getElementById('session-count');
        const alarmSound = document.getElementById('alarm-sound');
        const bodyElement = document.body;

        // --- Settings Modal Elements ---
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const focusTimeInput = document.getElementById('focus-time');
        const shortTimeInput = document.getElementById('short-time');
        const longTimeInput = document.getElementById('long-time');
        const sessionsInput = document.getElementById('sessions');

        // --- Timer State (Defaults to standard Pomodoro) ---
        let POMODORO_TIMES = { focus: 25 * 60, short: 5 * 60, long: 15 * 60 };
        let SESSIONS_UNTIL_LONG_BREAK = 4;
        
        let timerInterval;
        let isTimerRunning = false;
        let currentMode = 'focus';
        let currentTimeInSeconds = POMODORO_TIMES.focus;
        let sessionCount = 0;
        let hasNotificationPermission = false;

        // --- Timer Functions ---
        function formatTime(seconds) {
            const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
            const remainingSeconds = String(seconds % 60).padStart(2, '0');
            return `${minutes}:${remainingSeconds}`;
        }

        function updateTimerDisplay() {
            const timeString = formatTime(currentTimeInSeconds);
            timerDisplay.textContent = timeString;
            document.title = `${timeString} - ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)}`;
        }

        function startTimer() {
            isTimerRunning = true;
            startPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';

            timerInterval = setInterval(() => {
                currentTimeInSeconds--;
                updateTimerDisplay();

                if (currentTimeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    alarmSound.play();
                    autoSwitchMode();
                }
            }, 1000);
        }

        function pauseTimer() {
            isTimerRunning = false;
            startPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            clearInterval(timerInterval);
        }

        function toggleStartPause() {
            if (!hasNotificationPermission) {
                requestNotificationPermission();
                hasNotificationPermission = true;
            }
            if (isTimerRunning) { pauseTimer(); } else { startTimer(); }
        }

        function updateSessionDisplay() {
            const displayCount = sessionCount % SESSIONS_UNTIL_LONG_BREAK;
            const totalSessions = SESSIONS_UNTIL_LONG_BREAK;
            if (displayCount === 0 && sessionCount !== 0) {
                sessionCountDisplay.textContent = `Session: ${totalSessions} of ${totalSessions}`;
            } else {
                sessionCountDisplay.textContent = `Session: ${displayCount} of ${totalSessions}`;
            }
        }

        function sendNotification(nextMode) {
            if (Notification.permission !== 'granted') return;
            const title = "Focus Timer";
            let body;
            if (nextMode === 'focus') { body = "Time to focus!"; }
            else if (nextMode === 'short') { body = "Time for a short break!"; }
            else { body = "Time for a long break!"; }
            new Notification(title, { body: body });
        }

        function autoSwitchMode() {
            let nextMode;
            if (currentMode === 'focus') {
                sessionCount++;
                updateSessionDisplay();
                nextMode = (sessionCount % SESSIONS_UNTIL_LONG_BREAK === 0) ? 'long' : 'short';
            } else {
                nextMode = 'focus';
            }
            sendNotification(nextMode);
            setMode(nextMode);
            startTimer(); // Auto-start the next session
        }

        function setMode(mode) {
            currentMode = mode;
            pauseTimer();
            currentTimeInSeconds = POMODORO_TIMES[mode];
            updateTimerDisplay();
            
            bodyElement.classList.remove('state-focus', 'state-break');
            if (mode === 'focus') {
                bodyElement.classList.add('state-focus');
            } else {
                bodyElement.classList.add('state-break');
            }
            
            focusBtn.classList.toggle('mode-btn-active', mode === 'focus');
            shortBtn.classList.toggle('mode-btn-active', mode === 'short');
            longBtn.classList.toggle('mode-btn-active', mode === 'long');

            if (mode === 'focus') {
                updateSessionDisplay();
            } else {
                sessionCountDisplay.textContent = 'Time for a break!';
            }
        }

        function skipSession() {
            pauseTimer();
            autoSwitchMode();
        }

        function requestNotificationPermission() {
            if (!('Notification'in window)) return;
            if (Notification.permission !== 'denied' && Notification.permission !== 'granted') {
                Notification.requestPermission().then(p => { hasNotificationPermission = (p === 'granted'); });
            } else {
                hasNotificationPermission = (Notification.permission === 'granted');
            }
        }

        // --- Settings Logic ---
        function openSettings() {
            focusTimeInput.value = POMODORO_TIMES.focus / 60;
            shortTimeInput.value = POMODORO_TIMES.short / 60;
            longTimeInput.value = POMODORO_TIMES.long / 60;
            sessionsInput.value = SESSIONS_UNTIL_LONG_BREAK;
            settingsModal.classList.remove('hidden');
        }
        function closeSettings() { settingsModal.classList.add('hidden'); }
        function saveSettings() {
            const settings = {
                focus: parseInt(focusTimeInput.value) * 60,
                short: parseInt(shortTimeInput.value) * 60,
                long: parseInt(longTimeInput.value) * 60,
                sessions: parseInt(sessionsInput.value)
            };
            localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
            applySettings(settings);
            closeSettings();
        }
        function applySettings(settings) {
            if (!settings) return;
            POMODORO_TIMES = { focus: settings.focus, short: settings.short, long: settings.long };
            SESSIONS_UNTIL_LONG_BREAK = settings.sessions;
            setMode('focus');
            updateSessionDisplay();
        }
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('pomodoroSettings'));
            if (settings) { applySettings(settings); }
        }

        // --- Event Listeners ---
        startPauseBtn.addEventListener('click', toggleStartPause);
        skipBtn.addEventListener('click', skipSession);
        focusBtn.addEventListener('click', () => setMode('focus'));
        shortBtn.addEventListener('click', () => setMode('short'));
        longBtn.addEventListener('click', () => setMode('long'));

        settingsBtn.addEventListener('click', openSettings);
        closeSettingsBtn.addEventListener('click', closeSettings);
        saveSettingsBtn.addEventListener('click', saveSettings);

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                toggleStartPause();
            }
        });

        // --- Initial Setup ---
        loadSettings(); // Load saved settings (if any)
        setMode('focus'); // Start on 'focus' mode

    </script>
</body>
</html>
